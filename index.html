<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
    <meta name="theme-color" content="#764ba2" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="52 Books 2026" />
    <title>52-Week Feel-Good Book Challenge</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Georgia", serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 10px;
        min-height: 100vh;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        padding: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }

      @media (min-width: 768px) {
        body {
          padding: 20px;
        }
        .container {
          padding: 40px;
        }
      }

      h1 {
        text-align: center;
        color: #764ba2;
        font-size: 1.75em;
        margin-bottom: 10px;
        line-height: 1.2;
      }

      @media (min-width: 768px) {
        h1 {
          font-size: 2.5em;
        }
      }

      .subtitle {
        text-align: center;
        color: #666;
        font-size: 0.95em;
        margin-bottom: 20px;
        font-style: italic;
      }

      @media (min-width: 768px) {
        .subtitle {
          font-size: 1.1em;
          margin-bottom: 40px;
        }
      }

      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 12px;
        margin-bottom: 20px;
      }

      @media (min-width: 480px) {
        .calendar-grid {
          grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
          gap: 15px;
        }
      }

      @media (min-width: 768px) {
        .calendar-grid {
          grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
          gap: 20px;
          margin-bottom: 40px;
        }
      }

      .week-card {
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        padding: 12px;
        background: #fafafa;
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
        height: 320px;
        display: flex;
        flex-direction: column;
        -webkit-tap-highlight-color: rgba(118, 75, 162, 0.1);
        touch-action: manipulation;
      }

      @media (min-width: 768px) {
        .week-card {
          padding: 20px;
          height: 380px;
        }
      }

      .week-card:hover,
      .week-card:active {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        border-color: #764ba2;
      }

      @media (hover: none) {
        .week-card:hover {
          transform: none;
        }
        .week-card:active {
          transform: scale(0.98);
        }
      }

      .week-card.completed {
        opacity: 0.6;
      }

      .week-card.completed .book-cover,
      .week-card.completed .book-cover-placeholder {
        opacity: 0.7;
        filter: grayscale(0.3);
      }

      .week-card.current-week {
        background: #e3f2fd;
        border-color: #2196f3;
        box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
      }

      .week-card.past-week {
        background: #fff9e6;
        border-color: #ffc107;
      }

      .book-cover-view {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        flex: 1;
      }

      .book-details-view {
        display: none;
        flex-direction: column;
        flex: 1;
        padding: 10px 0;
        overflow-y: auto;
      }

      .week-card.show-details .book-cover-view {
        display: none;
      }

      .week-card.show-details .book-details-view {
        display: flex;
      }

      .book-info {
        flex: 1;
        overflow-y: auto;
      }

      .week-number {
        font-size: 0.9em;
        color: #764ba2;
        font-weight: bold;
        margin-bottom: 4px;
      }

      .week-dates {
        font-size: 0.8em;
        color: #999;
        margin-bottom: 8px;
      }

      .book-title {
        font-size: 1.1em;
        font-weight: bold;
        color: #333;
        margin-bottom: 6px;
      }

      .book-author {
        font-size: 0.95em;
        color: #666;
        margin-bottom: 10px;
      }

      .synopsis {
        font-size: 0.85em;
        color: #555;
        margin-top: 10px;
        line-height: 1.5;
      }

      .progress-bar {
        display: none;
      }

      .progress-fill {
        display: none;
      }

      .controls {
        text-align: center;
        margin-bottom: 20px;
        display: flex;
        gap: 8px;
        justify-content: center;
        flex-wrap: wrap;
      }

      @media (min-width: 768px) {
        .controls {
          margin-bottom: 30px;
          gap: 10px;
        }
      }

      button {
        background: #764ba2;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 25px;
        font-size: 0.9em;
        cursor: pointer;
        margin: 0;
        transition: all 0.3s ease;
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
        min-height: 44px;
      }

      @media (min-width: 768px) {
        button {
          padding: 12px 30px;
          font-size: 1em;
          margin: 0 5px;
        }
      }

      button:hover,
      button:active {
        background: #667eea;
        transform: scale(1.05);
      }

      @media (hover: none) {
        button:hover {
          transform: none;
        }
        button:active {
          transform: scale(0.95);
        }
      }

      button.secondary {
        background: #6c757d;
      }

      button.secondary:hover,
      button.secondary:active {
        background: #5a6268;
      }

      .add-book-section {
        display: none;
        background: #f5f5f5;
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 30px;
      }

      .add-book-section.visible {
        display: block;
      }

      .add-book-section h2 {
        color: #764ba2;
        margin-bottom: 20px;
        font-size: 1.5em;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        color: #333;
        font-weight: bold;
      }

      .form-group input {
        width: 100%;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        font-family: Georgia, serif;
        -webkit-appearance: none;
        appearance: none;
      }

      .form-group input:focus {
        outline: none;
        border-color: #764ba2;
      }

      .btn-add {
        background: #4caf50;
        margin-top: 10px;
      }

      .btn-add:hover {
        background: #45a049;
      }

      .loading-message {
        text-align: center;
        color: #764ba2;
        padding: 20px;
        font-style: italic;
      }

      .error-message {
        background: #ffebee;
        color: #c62828;
        padding: 15px;
        border-radius: 8px;
        margin-top: 10px;
      }

      .book-cover {
        width: 100%;
        max-width: 160px;
        height: 240px;
        object-fit: contain;
        border-radius: 8px;
        background: #e0e0e0;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      @media (min-width: 768px) {
        .book-cover {
          max-width: 200px;
          height: 300px;
        }
      }

      .book-cover-view .book-cover {
        margin: auto;
      }

      .complete-checkbox {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 24px;
        height: 24px;
        cursor: pointer;
        accent-color: #4caf50;
      }

      .book-cover-placeholder {
        width: 100%;
        max-width: 160px;
        height: 240px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 0.85em;
        font-weight: bold;
        text-align: center;
        padding: 15px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      @media (min-width: 768px) {
        .book-cover-placeholder {
          max-width: 200px;
          height: 300px;
          font-size: 1.2em;
          padding: 20px;
        }
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
      }

      .modal.visible {
        display: flex;
      }

      .modal-content {
        background-color: white;
        padding: 30px;
        border-radius: 15px;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      }

      .modal-content h2 {
        color: #764ba2;
        margin-bottom: 20px;
      }

      .modal-content input {
        width: 100%;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 1.1em;
        margin-bottom: 15px;
        font-family: Georgia, serif;
      }

      .modal-content input:focus {
        outline: none;
        border-color: #764ba2;
      }

      .modal-buttons {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
      }

      .settings-section {
        display: none;
        background: #f5f5f5;
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 30px;
      }

      .settings-section.visible {
        display: block;
      }

      .settings-section h2 {
        color: #764ba2;
        margin-bottom: 20px;
        font-size: 1.5em;
      }

      .sync-status {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 12px;
        font-size: 0.75em;
        margin-left: 5px;
      }

      @media (min-width: 768px) {
        .sync-status {
          padding: 5px 12px;
          font-size: 0.85em;
          margin-left: 10px;
        }
      }

      .sync-status.synced {
        background: #e8f5e9;
        color: #2e7d32;
        cursor: pointer;
        -webkit-tap-highlight-color: transparent;
      }

      .sync-status.synced:hover,
      .sync-status.synced:active {
        background: #c8e6c9;
      }

      .sync-status.not-synced {
        background: #fff3e0;
        color: #f57c00;
      }

      .book-search-results {
        max-height: 300px;
        overflow-y: auto;
        margin-top: 10px;
        border: 2px solid #ddd;
        border-radius: 8px;
        background: white;
      }

      .book-search-result {
        padding: 12px;
        border-bottom: 1px solid #eee;
        cursor: pointer;
        display: flex;
        gap: 12px;
        align-items: center;
      }

      .book-search-result:hover {
        background: #f5f5f5;
      }

      .book-search-result img {
        width: 50px;
        height: 75px;
        object-fit: cover;
        border-radius: 4px;
      }

      .book-search-result-info {
        flex: 1;
      }

      .book-search-result-title {
        font-weight: bold;
        color: #333;
      }

      .book-search-result-author {
        font-size: 0.9em;
        color: #666;
      }

      @media print {
        body {
          background: white;
        }
        .container {
          box-shadow: none;
        }
        .controls,
        .add-book-section,
        .settings-section {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ðŸ“š 52-Week Feel-Good Book Challenge</h1>
      <p class="subtitle">Wholesome, uplifting books â€¢ All standalone books</p>

      <div class="controls">
        <button onclick="toggleAddBookSection()">Add a Book</button>
        <button class="secondary" id="settingsButton" onclick="toggleSettings()">Settings</button>
        <button class="secondary" onclick="syncNow()">Sync Now</button>
        <span class="sync-status" id="syncStatus"></span>
      </div>

      <div class="settings-section" id="settingsSection">
        <h2>GitHub Sync Settings</h2>
        <div class="form-group">
          <label for="githubToken">GitHub Personal Access Token:</label>
          <input
            type="password"
            id="githubToken"
            placeholder="ghp_xxxxxxxxxxxx"
          />
          <small style="color: #666; display: block; margin-top: 5px;">
            Create a token at: GitHub â†’ Settings â†’ Developer settings â†’ Personal access tokens â†’ Tokens (classic)<br>
            Required scope: <strong>gist</strong>
          </small>
        </div>
        <button onclick="saveSettings()">Save Settings</button>
        <div id="settingsMessage"></div>
      </div>

      <div class="add-book-section" id="addBookSection">
        <h2>Add a Book to Your List</h2>
        <div class="form-group">
          <label for="weekNumber">Insert at Week #:</label>
          <input type="number" id="weekNumber" min="1" placeholder="e.g., 5" />
        </div>
        <div class="form-group">
          <label for="bookSearch">Search for a Book:</label>
          <input
            type="text"
            id="bookSearch"
            placeholder="Type to search by title or author..."
          />
          <div id="searchResults" class="book-search-results" style="display: none;"></div>
        </div>
        <div class="form-group">
          <label for="bookTitle">Book Title:</label>
          <input
            type="text"
            id="bookTitle"
            placeholder="e.g., The Midnight Library"
            readonly
          />
        </div>
        <div class="form-group">
          <label for="bookAuthor">Author:</label>
          <input type="text" id="bookAuthor" placeholder="e.g., Matt Haig" readonly />
        </div>
        <input type="hidden" id="bookCover" />
        <input type="hidden" id="bookDescription" />
        <button class="btn-add" onclick="addBookToList()">
          Add Book to Week
        </button>
        <div id="statusMessage"></div>
      </div>

      <div class="calendar-grid" id="bookGrid"></div>
    </div>

    <!-- PIN Modal -->
    <div class="modal" id="pinModal">
      <div class="modal-content">
        <h2>Enter PIN</h2>
        <input
          type="password"
          id="pinInput"
          placeholder="Enter 4-digit PIN"
          maxlength="4"
        />
        <div class="modal-buttons">
          <button class="secondary" onclick="closePinModal()">Cancel</button>
          <button onclick="verifyPin()">Submit</button>
        </div>
        <div id="pinError" class="error-message" style="display: none; margin-top: 10px;"></div>
      </div>
    </div>

    <script>
      let books = [
        {
          week: 1,
          title: "The Switch",
          author: "Beth O'Leary",
          synopsis:
            "A grandmother and her twentysomething granddaughter swap lives for two months. Heartwarming story about connection and self-discovery.",
        },
        {
          week: 2,
          title: "The Sword in the Stone",
          author: "T.H. White",
          synopsis:
            "Young Arthur, known as Wart, is tutored by the wizard Merlyn who transforms him into various animals to teach him about life, leadership, and becoming a king.",
        },
        {
          week: 3,
          title: "The Authenticity Project",
          author: "Clare Pooley",
          synopsis:
            "A green notebook inviting people to share their truth connects six strangers across London in unexpected ways.",
        },
        {
          week: 4,
          title: "Uprooted",
          author: "Naomi Novik",
          synopsis:
            "A young village woman is chosen by a powerful wizard to serve him, discovering her own magical abilities while battling a corrupt, living Wood.",
        },
        {
          week: 5,
          title: "The Heart's Invisible Furies",
          author: "John Boyne",
          synopsis:
            "Spanning seven decades, Cyril's journey from 1940s Ireland to present dayâ€”finding love, friendship, and acceptance despite rejection.",
        },
        {
          week: 6,
          title: "Major Pettigrew's Last Stand",
          author: "Helen Simonson",
          synopsis:
            "A retired British officer and a Pakistani shopkeeper's widow form an unlikely friendship in a small English village. Charming romance about finding love later in life.",
        },
        {
          week: 7,
          title: "Project Hail Mary",
          author: "Andy Weir",
          synopsis:
            "A lone astronaut wakes on a spaceship with no memory, facing a mission to save Earth. Thrilling space adventure with humor and heart.",
        },
        {
          week: 8,
          title: "The Storied Life of A.J. Fikry",
          author: "Gabrielle Zevin",
          synopsis:
            "A grumpy bookstore owner's life changes when a mysterious package arrives. A love letter to books and second chances.",
        },
        {
          week: 9,
          title: "The Measure",
          author: "Nikki Erlick",
          synopsis:
            "Everyone receives a box with a string showing their lifespan. Explores how people choose to live knowing how much time they have.",
        },
        {
          week: 10,
          title: "The Rosie Project",
          author: "Graeme Simsion",
          synopsis:
            "Socially awkward genetics professor creates a questionnaire to find the perfect wife, then meets Rosie who breaks all his rules.",
        },
        {
          week: 11,
          title: "Eleanor Oliphant Is Completely Fine",
          author: "Gail Honeyman",
          synopsis:
            "Socially isolated Eleanor's structured life changes when she develops a crush and befriends a coworker. About healing and connection.",
        },
        {
          week: 12,
          title: "The Humans",
          author: "Matt Haig",
          synopsis:
            "An alien sent to Earth discovers what makes humanity beautifulâ€”love, music, peanut butter. Funny and touching celebration of being human.",
        },
        {
          week: 13,
          title: "The Wedding Date",
          author: "Jasmine Guillory",
          synopsis:
            "Drew and Alexa fake-date through a wedding weekend and have way more fun than expected. Fun contemporary romance.",
        },
        {
          week: 14,
          title: "Beach Read",
          author: "Emily Henry",
          synopsis:
            "Two writers with opposite styles challenge each other to write in each other's genres while spending summer as neighbors.",
        },
        {
          week: 15,
          title: "The Guernsey Literary and Potato Peel Pie Society",
          author: "Mary Ann Shaffer",
          synopsis:
            "In 1946, a London writer exchanges letters with Guernsey residents who formed a book club during WWII. Charming and witty.",
        },
        {
          week: 16,
          title: "The Flatshare",
          author: "Beth O'Leary",
          synopsis:
            "Tiffy and Leon share an apartment but have never metâ€”she has it during day, he has it at night. They communicate through Post-its.",
        },
        {
          week: 17,
          title: "The Bookish Life of Nina Hill",
          author: "Abbi Waxman",
          synopsis:
            "Bookworm Nina's ordered life is upended when she discovers she has a large family. Cozy and funny, perfect for book lovers.",
        },
        {
          week: 18,
          title: "Circe",
          author: "Madeline Miller",
          synopsis:
            "The story of the goddess and witch Circe, reimagined as a tale of finding your power and place. Beautiful mythological fantasy.",
        },
        {
          week: 19,
          title: "The Seven Husbands of Evelyn Hugo",
          author: "Taylor Jenkins Reid",
          synopsis:
            "Aging Hollywood icon Evelyn Hugo tells her life story to an unknown journalist. Compelling tale of love, ambition, and authenticity.",
        },
        {
          week: 20,
          title: "All the Light We Cannot See",
          author: "Anthony Doerr",
          synopsis:
            "A blind French girl and German boy's paths collide in WWII France. Beautiful story about humanity, hope, and kindness.",
        },
        {
          week: 21,
          title: "The 100-Year-Old Man Who Climbed Out the Window",
          author: "Jonas Jonasson",
          synopsis:
            "On his 100th birthday, Allan escapes his nursing home and embarks on an absurd adventure. Hilarious and delightfully ridiculous.",
        },
        {
          week: 22,
          title: "A Gentleman in Moscow",
          author: "Amor Towles",
          synopsis:
            "A Russian aristocrat under house arrest in a grand hotel discovers unexpected joy. Elegant, wise, and deeply satisfying.",
        },
        {
          week: 23,
          title: "The Princess Bride",
          author: "William Goldman",
          synopsis:
            "The classic tale of true love, adventure, revenge, giants, and rodents of unusual size. Witty, romantic, endlessly quotable.",
        },
        {
          week: 24,
          title: "Piranesi",
          author: "Susanna Clarke",
          synopsis:
            "A man lives in a mysterious house with infinite rooms flooded by the sea. Enchanting puzzle unfolds as he uncovers truth.",
        },
        {
          week: 25,
          title: "The Invisible Life of Addie LaRue",
          author: "V.E. Schwab",
          synopsis:
            "A woman makes a Faustian bargain to live forever but be forgottenâ€”until she meets someone who remembers her. Magical and hopeful.",
        },
        {
          week: 26,
          title: "Icebreaker",
          author: "Hannah Grace",
          synopsis:
            "Figure skater and hockey captain forced to share rink time. Opposites clash then heat up. Sports romance.",
        },
        {
          week: 27,
          title: "The Five People You Meet in Heaven",
          author: "Mitch Albom",
          synopsis:
            "An elderly amusement park worker meets five people in heaven who explain how his life mattered. Moving meditation on connection.",
        },
        {
          week: 28,
          title: "The Particular Sadness of Lemon Cake",
          author: "Aimee Bender",
          synopsis:
            "A girl discovers she can taste people's emotions in their food. Magical, poignant story about family, empathy, and growing up with an unusual gift.",
        },
        {
          week: 29,
          title: "Born a Crime",
          author: "Trevor Noah",
          synopsis:
            "Trevor Noah's hilarious memoir of growing up in South Africa during and after apartheid. Filled with humor, hope, and mother's love.",
        },
        {
          week: 30,
          title: "The Art of Racing in the Rain",
          author: "Garth Stein",
          synopsis:
            "Narrated by Enzo, a philosophical dog following his owner's life through triumphs and hardships. Touching tribute to human-dog bond.",
        },
        {
          week: 31,
          title: "The Little Paris Bookshop",
          author: "Nina George",
          synopsis:
            "A Parisian book barge owner sets off through France, dispensing books and wisdom. Lyrical exploration of healing through literature.",
        },
        {
          week: 32,
          title: "The Marlow Murder Club",
          author: "Robert Thorogood",
          synopsis:
            "A 77-year-old crossword setter witnesses a murder and teams up with two unlikely friends to investigate when police dismiss her story. Charming cozy mystery.",
        },
        {
          week: 33,
          title: "A Murder for Miss Hortense",
          author: "Vanessa Riley",
          synopsis:
            "A retired Jamaican nurse turned amateur sleuth investigates when an unidentified man is found dead in her Birmingham community. Fearless and unforgettable.",
        },
        {
          week: 34,
          title: "Tom Lake",
          author: "Ann Patchett",
          synopsis:
            "During pandemic lockdown, a mother tells her daughters about her past as an actress and a summer romance. Tender family story.",
        },
        {
          week: 35,
          title: "The Unlikely Pilgrimage of Harold Fry",
          author: "Rachel Joyce",
          synopsis:
            "Harold spontaneously decides to walk 600 miles to see a dying friend. Quiet, moving story about redemption and the journey itself.",
        },
        {
          week: 36,
          title: "The Night Circus",
          author: "Erin Morgenstern",
          synopsis:
            "A magical circus arrives without warning, where two young magicians are bound in a high-stakes competition. Enchanting and romantic.",
        },
        {
          week: 37,
          title: "The Sweetness at the Bottom of the Pie",
          author: "Alan Bradley",
          synopsis:
            "11-year-old aspiring chemist Flavia de Luce investigates a murder in 1950s England. Charming, witty mystery with delightful protagonist.",
        },
        {
          week: 38,
          title: "Howl's Moving Castle",
          author: "Diana Wynne Jones",
          synopsis:
            "Sophie is cursed to become old and takes refuge in a wizard's moving castle. Whimsical, magical, full of adventure and romance.",
        },
        {
          week: 39,
          title: "The Hating Game",
          author: "Sally Thorne",
          synopsis:
            "Two executive assistants who sit across from each other have hated each other for yearsâ€”until their hate might be something else entirely.",
        },
        {
          week: 40,
          title: "Klara and the Sun",
          author: "Kazuo Ishiguro",
          synopsis:
            "An Artificial Friend named Klara observes the world, hoping to be chosen by a child. Gentle sci-fi about love and caring.",
        },
        {
          week: 41,
          title: "The Secret Garden",
          author: "Frances Hodgson Burnett",
          synopsis:
            "Orphaned Mary discovers a hidden garden and helps itâ€”and herselfâ€”come back to life. Timeless classic about healing and growth.",
        },
        {
          week: 42,
          title: "Where'd You Go, Bernadette",
          author: "Maria Semple",
          synopsis:
            "When a brilliant architect disappears, her daughter pieces together what happened through emails and documents. Quirky and heartwarming.",
        },
        {
          week: 43,
          title: "The Keeper of Lost Things",
          author: "Ruth Hogan",
          synopsis:
            "A man collects lost objects hoping to reunite them with owners. After his death, his assistant continues his mission. Charming tale.",
        },
        {
          week: 44,
          title: "The House at Riverton",
          author: "Kate Morton",
          synopsis:
            "In 1924, a young poet dies at a party. Decades later, the elderly housemaid who witnessed it tells the true story. Atmospheric mystery.",
        },
        {
          week: 45,
          title: "The Song of Achilles",
          author: "Madeline Miller",
          synopsis:
            "Achilles and Patroclus' friendship and love, retold through Patroclus' eyes. Beautiful, epic reimagining of Greek mythology.",
        },
        {
          week: 46,
          title: "Station Eleven",
          author: "Emily St. John Mandel",
          synopsis:
            "Twenty years after a pandemic, a theater troupe performs Shakespeare in settlements. Hopeful post-apocalyptic story about art and humanity.",
        },
        {
          week: 47,
          title: "The Giver of Stars",
          author: "Jojo Moyes",
          synopsis:
            "Based on true history, women on horseback deliver library books through 1930s Kentucky mountains. Celebrates books and female friendship.",
        },
        {
          week: 48,
          title: "The Vanishing Half",
          author: "Brit Bennett",
          synopsis:
            "Twin sisters choose divergent paths. Multigenerational story about identity, family, and finding where you belong.",
        },
        {
          week: 49,
          title: "Commonwealth",
          author: "Ann Patchett",
          synopsis:
            "After a chance encounter, two families' lives intertwine over decades. Warm exploration of blended families and forgiveness.",
        },
        {
          week: 50,
          title: "Less",
          author: "Andrew Sean Greer",
          synopsis:
            "To avoid his ex's wedding, a failed novelist embarks on a worldwide journey. Hilarious, tender, surprisingly life-affirming.",
        },
        {
          week: 51,
          title: "The Ten Thousand Doors of January",
          author: "Alix E. Harrow",
          synopsis:
            "A girl discovers a book about magical doors between worlds and realizes it might be about her. Enchanting tale about belonging.",
        },
        {
          week: 52,
          title: "Tomorrow, and Tomorrow, and Tomorrow",
          author: "Gabrielle Zevin",
          synopsis:
            "Two friends collaborate on video games over three decades. Beautiful story about artistic partnership and enduring connection.",
        },
      ];

      // Authentication state
      let isAuthenticated = sessionStorage.getItem("authenticated") === "true";
      const CORRECT_PIN = "0879";

      // GitHub Gist integration
      let githubToken = localStorage.getItem("githubToken") || "";
      let gistId = localStorage.getItem("gistId") || "";

      // Load books from Gist if available, otherwise use local storage or default
      let completed = new Set(
        JSON.parse(localStorage.getItem("completedBooks") || "[]")
      );

      // Fetch cover images for existing books from Open Library
      async function fetchMissingCovers() {
        let updated = false;
        // Only fetch for books that:
        // 1. Don't have a coverUrl yet
        // 2. Haven't been checked before (no coverFetched flag)
        const booksToUpdate = books.filter(book => !book.coverUrl && !book.coverFetched);

        if (booksToUpdate.length === 0) {
          return; // All books already have covers or have been checked
        }

        console.log(`Fetching covers for ${booksToUpdate.length} books...`);

        for (const book of booksToUpdate) {
          try {
            // Search Open Library for this book
            const response = await fetch(
              `https://openlibrary.org/search.json?title=${encodeURIComponent(book.title)}&author=${encodeURIComponent(book.author)}&limit=1`
            );
            const data = await response.json();

            if (data.docs && data.docs.length > 0) {
              const result = data.docs[0];
              const coverId = result.cover_i;

              if (coverId) {
                book.coverUrl = `https://covers.openlibrary.org/b/id/${coverId}-M.jpg`;
                console.log(`Found cover for: ${book.title}`);
              }
            }

            // Mark as fetched (even if no cover found) to prevent re-fetching
            book.coverFetched = true;
            book.lastCoverCheck = new Date().toISOString();
            updated = true;

            // Small delay to avoid rate limiting
            await new Promise(resolve => setTimeout(resolve, 200));
          } catch (error) {
            console.error(`Error fetching cover for ${book.title}:`, error);
            // Still mark as fetched to prevent infinite retries
            book.coverFetched = true;
            book.lastCoverCheck = new Date().toISOString();
            updated = true;
          }
        }

        if (updated) {
          await saveBooks();
          console.log("Updated books with cover images and cached results");
        }
      }

      // Initialize - try to load from Gist first
      async function initializeApp() {
        await loadFromGist();
        await fetchMissingCovers(); // Fetch covers for books that don't have them
        updateSyncStatus();
        renderBooks();
      }

      // PIN Authentication
      function toggleAddBookSection() {
        if (!isAuthenticated) {
          showPinModal();
        } else {
          const section = document.getElementById("addBookSection");
          section.classList.toggle("visible");
        }
      }

      function showPinModal() {
        const modal = document.getElementById("pinModal");
        modal.classList.add("visible");
        document.getElementById("pinInput").value = "";
        document.getElementById("pinError").style.display = "none";
      }

      function closePinModal() {
        const modal = document.getElementById("pinModal");
        modal.classList.remove("visible");
      }

      function verifyPin() {
        const input = document.getElementById("pinInput").value;
        const errorDiv = document.getElementById("pinError");

        if (input === CORRECT_PIN) {
          isAuthenticated = true;
          sessionStorage.setItem("authenticated", "true");
          closePinModal();
          document.getElementById("addBookSection").classList.add("visible");
          errorDiv.style.display = "none";
        } else {
          errorDiv.textContent = "Incorrect PIN. Please try again.";
          errorDiv.style.display = "block";
        }
      }

      // Settings Functions
      function toggleSettings() {
        const section = document.getElementById("settingsSection");
        section.classList.toggle("visible");
        if (section.classList.contains("visible")) {
          document.getElementById("githubToken").value = githubToken;
        }
      }

      function saveSettings() {
        const token = document.getElementById("githubToken").value.trim();
        const messageDiv = document.getElementById("settingsMessage");

        if (token) {
          githubToken = token;
          localStorage.setItem("githubToken", token);
          messageDiv.innerHTML = '<div style="background: #e8f5e9; color: #2e7d32; padding: 15px; border-radius: 8px; margin-top: 10px;">âœ“ Settings saved! Click "Sync Now" to sync your books.</div>';
          updateSyncStatus();
        } else {
          messageDiv.innerHTML = '<div class="error-message">Please enter a GitHub token.</div>';
        }
      }

      // GitHub Gist Sync Functions
      async function loadFromGist() {
        if (!githubToken || !gistId) {
          // Try to load from localStorage
          const storedBooks = localStorage.getItem("bookList");
          if (storedBooks) {
            books = JSON.parse(storedBooks);
          }
          return;
        }

        try {
          const response = await fetch(`https://api.github.com/gists/${gistId}`, {
            headers: {
              Authorization: `token ${githubToken}`,
              Accept: "application/vnd.github.v3+json",
            },
          });

          if (response.ok) {
            const gist = await response.json();
            const content = gist.files["52-books-2026.json"].content;
            const data = JSON.parse(content);
            books = data.books || books;
            completed = new Set(data.completed || []);
            localStorage.setItem("bookList", JSON.stringify(books));
            localStorage.setItem("completedBooks", JSON.stringify([...completed]));
          }
        } catch (error) {
          console.error("Error loading from Gist:", error);
          // Fallback to localStorage
          const storedBooks = localStorage.getItem("bookList");
          if (storedBooks) {
            books = JSON.parse(storedBooks);
          }
        }
      }

      async function saveToGist() {
        if (!githubToken) {
          // Just save to localStorage
          localStorage.setItem("bookList", JSON.stringify(books));
          localStorage.setItem("completedBooks", JSON.stringify([...completed]));
          return;
        }

        const data = {
          books: books,
          completed: [...completed],
          lastUpdated: new Date().toISOString(),
        };

        const gistData = {
          description: "52-Week Book Challenge 2026",
          public: false,
          files: {
            "52-books-2026.json": {
              content: JSON.stringify(data, null, 2),
            },
          },
        };

        try {
          let response;
          if (gistId) {
            // Update existing gist
            response = await fetch(`https://api.github.com/gists/${gistId}`, {
              method: "PATCH",
              headers: {
                Authorization: `token ${githubToken}`,
                Accept: "application/vnd.github.v3+json",
              },
              body: JSON.stringify(gistData),
            });
          } else {
            // Create new gist
            response = await fetch("https://api.github.com/gists", {
              method: "POST",
              headers: {
                Authorization: `token ${githubToken}`,
                Accept: "application/vnd.github.v3+json",
              },
              body: JSON.stringify(gistData),
            });
          }

          if (response.ok) {
            const gist = await response.json();
            gistId = gist.id;
            localStorage.setItem("gistId", gistId);
            localStorage.setItem("bookList", JSON.stringify(books));
            localStorage.setItem("completedBooks", JSON.stringify([...completed]));
            updateSyncStatus();
            return true;
          } else {
            throw new Error("Failed to sync");
          }
        } catch (error) {
          console.error("Error saving to Gist:", error);
          // Fallback to localStorage
          localStorage.setItem("bookList", JSON.stringify(books));
          localStorage.setItem("completedBooks", JSON.stringify([...completed]));
          return false;
        }
      }

      async function syncNow() {
        const statusEl = document.getElementById("syncStatus");
        const settingsButton = document.getElementById("settingsButton");

        statusEl.textContent = "Syncing...";
        statusEl.className = "sync-status";

        const success = await saveToGist();
        if (success) {
          statusEl.textContent = "Synced âœ“";
          statusEl.className = "sync-status synced";
        } else {
          statusEl.textContent = "Sync failed - Check Settings";
          statusEl.className = "sync-status not-synced";
          settingsButton.style.display = "inline-block"; // Show settings on error
        }

        setTimeout(() => {
          updateSyncStatus();
        }, 3000);
      }

      function updateSyncStatus() {
        const statusEl = document.getElementById("syncStatus");
        const settingsButton = document.getElementById("settingsButton");

        if (githubToken && gistId) {
          // Fully configured and synced - hide Settings button
          statusEl.textContent = "Configured âœ“ (click to change)";
          statusEl.className = "sync-status synced";
          statusEl.onclick = toggleSettings; // Allow clicking to access settings
          settingsButton.style.display = "none";
        } else if (githubToken) {
          // Token set but no gist yet - show Settings button
          statusEl.textContent = "Ready to sync";
          statusEl.className = "sync-status not-synced";
          statusEl.onclick = null;
          settingsButton.style.display = "inline-block";
        } else {
          // Not configured - show Settings button
          statusEl.textContent = "Not configured";
          statusEl.className = "sync-status not-synced";
          statusEl.onclick = null;
          settingsButton.style.display = "inline-block";
        }
      }

      function getCurrentWeek() {
        const startDate = new Date(2026, 0, 4); // Jan 4, 2026
        const today = new Date();
        const diffTime = today - startDate;
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
        const currentWeek = Math.floor(diffDays / 7) + 1;
        return currentWeek;
      }

      function saveBooks() {
        saveToGist();
      }

      // Open Library API Book Search
      let searchTimeout;
      document.addEventListener("DOMContentLoaded", function() {
        const searchInput = document.getElementById("bookSearch");
        if (searchInput) {
          searchInput.addEventListener("input", function() {
            clearTimeout(searchTimeout);
            const query = this.value.trim();

            if (query.length < 3) {
              document.getElementById("searchResults").style.display = "none";
              return;
            }

            searchTimeout = setTimeout(() => searchBooks(query), 500);
          });
        }
      });

      async function searchBooks(query) {
        const resultsDiv = document.getElementById("searchResults");
        resultsDiv.innerHTML = '<div style="padding: 12px; color: #666;">Searching...</div>';
        resultsDiv.style.display = "block";

        try {
          const response = await fetch(
            `https://openlibrary.org/search.json?q=${encodeURIComponent(query)}&limit=10`
          );
          const data = await response.json();

          if (data.docs && data.docs.length > 0) {
            resultsDiv.innerHTML = "";
            data.docs.slice(0, 10).forEach((book) => {
              const title = book.title || "Unknown Title";
              const author = book.author_name ? book.author_name[0] : "Unknown Author";
              const coverId = book.cover_i;
              const coverUrl = coverId
                ? `https://covers.openlibrary.org/b/id/${coverId}-M.jpg`
                : "";
              const description = book.first_sentence ? book.first_sentence[0] : "";

              const resultDiv = document.createElement("div");
              resultDiv.className = "book-search-result";
              resultDiv.onclick = () => selectBook(title, author, coverUrl, description);

              resultDiv.innerHTML = `
                ${coverUrl ? `<img src="${coverUrl}" alt="${title}">` : '<div style="width: 50px; height: 75px; background: #ddd; border-radius: 4px;"></div>'}
                <div class="book-search-result-info">
                  <div class="book-search-result-title">${title}</div>
                  <div class="book-search-result-author">${author}</div>
                </div>
              `;

              resultsDiv.appendChild(resultDiv);
            });
          } else {
            resultsDiv.innerHTML = '<div style="padding: 12px; color: #666;">No results found</div>';
          }
        } catch (error) {
          console.error("Search error:", error);
          resultsDiv.innerHTML = '<div style="padding: 12px; color: #c62828;">Search failed. Please try again.</div>';
        }
      }

      function selectBook(title, author, coverUrl, description) {
        document.getElementById("bookTitle").value = title;
        document.getElementById("bookAuthor").value = author;
        document.getElementById("bookCover").value = coverUrl;
        document.getElementById("bookDescription").value = description;
        document.getElementById("searchResults").style.display = "none";
        document.getElementById("bookSearch").value = "";
      }

      async function addBookToList() {
        const weekNum = parseInt(document.getElementById("weekNumber").value);
        const title = document.getElementById("bookTitle").value.trim();
        const author = document.getElementById("bookAuthor").value.trim();
        const coverUrl = document.getElementById("bookCover").value.trim();
        const description = document.getElementById("bookDescription").value.trim();
        const statusDiv = document.getElementById("statusMessage");

        statusDiv.innerHTML = "";

        if (!weekNum || weekNum < 1) {
          statusDiv.innerHTML =
            '<div class="error-message">Please enter a valid week number (1 or greater)</div>';
          return;
        }

        if (!title || !author) {
          statusDiv.innerHTML =
            '<div class="error-message">Please select a book from search results</div>';
          return;
        }

        // Insert the book and push others down
        books = books.map((book) => {
          if (book.week >= weekNum) {
            return { ...book, week: book.week + 1 };
          }
          return book;
        });

        books.push({
          week: weekNum,
          title: title,
          author: author,
          synopsis: description || `A book by ${author}`,
          coverUrl: coverUrl || "",
          coverFetched: true, // Mark as fetched since we got it from search
          lastCoverCheck: new Date().toISOString(),
        });

        books.sort((a, b) => a.week - b.week);

        await saveBooks();
        renderBooks();

        statusDiv.innerHTML = `<div style="background: #e8f5e9; color: #2e7d32; padding: 15px; border-radius: 8px; margin-top: 10px;">âœ“ Successfully added "${title}" at Week ${weekNum}!</div>`;

        document.getElementById("weekNumber").value = "";
        document.getElementById("bookTitle").value = "";
        document.getElementById("bookAuthor").value = "";
        document.getElementById("bookCover").value = "";
        document.getElementById("bookDescription").value = "";

        setTimeout(() => {
          document.getElementById("addBookSection").classList.remove("visible");
        }, 2000);
      }

      function getWeekDates(weekNum) {
        // Start date: Jan 4, 2026 (Saturday)
        const startDate = new Date(2026, 0, 4);

        // Calculate the start of the week (Sunday)
        const daysToAdd = (weekNum - 1) * 7;
        const weekStart = new Date(startDate);
        weekStart.setDate(startDate.getDate() + daysToAdd);

        // Calculate the end of the week (Saturday)
        const weekEnd = new Date(weekStart);
        weekEnd.setDate(weekStart.getDate() + 6);

        const options = { month: "short", day: "numeric" };
        const startStr = weekStart.toLocaleDateString("en-US", options);
        const endStr = weekEnd.toLocaleDateString("en-US", options);

        // Add year if it changes
        const startYear = weekStart.getFullYear();
        const endYear = weekEnd.getFullYear();

        if (startYear === endYear) {
          return `${startStr} - ${endStr}, ${startYear}`;
        } else {
          return `${startStr}, ${startYear} - ${endStr}, ${endYear}`;
        }
      }

      function renderBooks() {
        const grid = document.getElementById("bookGrid");
        grid.innerHTML = "";
        const currentWeek = getCurrentWeek();

        books.forEach((book) => {
          const card = document.createElement("div");
          let cardClass = "week-card";

          if (book.week === currentWeek) {
            cardClass += " current-week";
          } else if (book.week < currentWeek) {
            cardClass += " past-week";
          }

          if (completed.has(book.week)) {
            cardClass += " completed";
          }

          card.className = cardClass;

          // Create cover view (default)
          const coverView = document.createElement("div");
          coverView.className = "book-cover-view";

          if (book.coverUrl) {
            coverView.innerHTML = `
              <img src="${book.coverUrl}" alt="${book.title}" class="book-cover" onerror="this.outerHTML='<div class=\\'book-cover-placeholder\\'>${book.title}</div>'">
            `;
          } else {
            coverView.innerHTML = `
              <div class="book-cover-placeholder">${book.title}</div>
            `;
          }

          // Create details view
          const detailsView = document.createElement("div");
          detailsView.className = "book-details-view";

          detailsView.innerHTML = `
            <input type="checkbox" class="complete-checkbox" ${completed.has(book.week) ? 'checked' : ''} onclick="event.stopPropagation(); toggleComplete(${book.week})">
            <div class="week-number">Week ${book.week}</div>
            <div class="week-dates">${getWeekDates(book.week)}</div>
            <div class="book-info">
              <div class="book-title">${book.title}</div>
              <div class="book-author">by ${book.author}</div>
              <div class="synopsis">${book.synopsis}</div>
            </div>
          `;

          // Toggle between views on click
          card.onclick = () => toggleCardView(card);

          card.appendChild(coverView);
          card.appendChild(detailsView);
          grid.appendChild(card);
        });
      }

      function toggleCardView(card) {
        card.classList.toggle("show-details");
      }

      function toggleComplete(week) {
        if (completed.has(week)) {
          completed.delete(week);
        } else {
          completed.add(week);
        }
        localStorage.setItem("completedBooks", JSON.stringify([...completed]));
        saveToGist();
        renderBooks();
      }

      // Initialize the app
      initializeApp();
    </script>
  </body>
</html>
